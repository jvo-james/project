<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kids Wear — One-off Dresses</title>

  <!-- Paystack inline -->
  <script src="https://js.paystack.co/v1/inline.js"></script>
</head>
<body>
  <!-- SITE HEADER -->
  <header class="site-header" role="banner">
    <div class="container header-inner">
      <a href="#" class="logo" aria-label="Kidswear brand">
        <i class="fa fa-heart logo-ico" aria-hidden="true"></i>
        <span class="brand-name">Tiny Threads</span>
      </a>

  <nav class="main-nav" role="navigation" aria-label="Primary">
    <ul class="nav-list">
      <li><a href="#hero"><i class="fa fa-home"></i> Home</a></li>
      <li><a href="#shop"><i class="fa fa-shopping-bag"></i> Shop</a></li>
      <li><a href="#contact"><i class="fa fa-envelope"></i> Contact</a></li>
      <li><a href="#about"><i class="fa fa-info-circle"></i> About</a></li>
    </ul>
  </nav>

  <div class="header-actions">
    <button id="search-toggle" class="icon-btn" aria-label="Search">
      <i class="fa fa-search"></i>
    </button>

    <button id="cart-toggle" class="icon-btn" aria-label="Open cart" aria-haspopup="true" aria-controls="cart-panel">
      <i class="fa fa-shopping-cart"></i>
      <span id="cart-badge" class="badge" aria-live="polite">0</span>
    </button>

    <!-- HAMBURGER / MOBILE TOGGLE -->
    <button id="mobile-toggle" class="hamburger" aria-label="Open menu" aria-expanded="false">
      <span class="hamburger-lines"></span>
      <i class="fa fa-bars"></i>
    </button>
  </div>
</div>

<!-- MOBILE NAV (will be toggled by JS) -->
<nav id="mobile-nav" class="mobile-nav" aria-hidden="true" aria-label="Mobile navigation">
  <ul>
    <li><a href="#hero"><i class="fa fa-home"></i> Home</a></li>
    <li><a href="#shop"><i class="fa fa-shopping-bag"></i> Shop</a></li>
    <li><a href="#contact"><i class="fa fa-envelope"></i> Contact</a></li>
    <li><a href="#about"><i class="fa fa-info-circle"></i> About</a></li>
  </ul>
  <div class="mobile-nav-footer">
    <a class="btn tiny" href="#"><i class="fa fa-user"></i> Admin</a>
  </div>
</nav>
```

  </header>

  <main id="main" role="main">

```
<!-- HERO / SLIDESHOW -->
<section id="hero" class="hero">
  <div class="hero-slider" data-slides="3" aria-roledescription="carousel">
    <div class="slide" data-slide="1" role="group" aria-roledescription="slide" aria-label="Slide 1 of 3">
      <div class="slide-inner">
        <picture class="hero-media">
          <img src="images/hero-1.jpg" alt="Bright kids dresses on display">
        </picture>
        <div class="hero-caption">
          <h1>Unique Dresses — Only One of Each</h1>
          <p>Handmade kids' dresses. Once it's sold, it's gone. Find the one that fits her best.</p>
          <div class="hero-cta">
            <a class="btn large" href="#shop"><i class="fa fa-shopping-bag"></i> Shop Now</a>
            <a class="btn outline" href="#about"><i class="fa fa-info-circle"></i> Learn More</a>
          </div>
        </div>
      </div>
    </div>

    <div class="slide" data-slide="2" role="group" aria-roledescription="slide" aria-label="Slide 2 of 3">
      <div class="slide-inner">
        <picture class="hero-media">
          <img src="images/hero-2.jpg" alt="Child wearing a floral dress">
        </picture>
        <div class="hero-caption">
          <h2>Playful, Pretty & Practical</h2>
          <p>Comfortable fabrics, joyful designs — perfect for parties and play dates.</p>
          <div class="hero-cta">
            <a class="btn large" href="#shop"><i class="fa fa-star"></i> Browse Styles</a>
          </div>
        </div>
      </div>
    </div>

    <div class="slide" data-slide="3" role="group" aria-roledescription="slide" aria-label="Slide 3 of 3">
      <div class="slide-inner">
        <picture class="hero-media">
          <img src="images/hero-3.jpg" alt="Close-up detail of dress fabric">
        </picture>
        <div class="hero-caption">
          <h2>Limited Editions</h2>
          <p>Each dress is one-of-a-kind — grab it before it's gone.</p>
          <div class="hero-cta">
            <a class="btn large" href="#shop"><i class="fa fa-bolt"></i> Limited Picks</a>
          </div>
        </div>
      </div>
    </div>

    <!-- hero controls (JS will hook these) -->
    <div class="hero-controls">
      <button class="hero-prev" aria-label="Previous slide"><i class="fa fa-chevron-left"></i></button>
      <button class="hero-next" aria-label="Next slide"><i class="fa fa-chevron-right"></i></button>
      <div class="hero-dots" role="tablist" aria-label="Slide indicators"></div>
    </div>
  </div>
</section>

<!-- CATEGORIES (AGE RANGES) -->
<section class="categories" aria-label="Age categories">
  <div class="container">
    <h3 class="section-title"><i class="fa fa-list"></i> Sizes & Age Groups</h3>
    <div class="category-chips" role="toolbar" aria-label="Filter by age">
      <button class="chip" data-filter="0-3">0–3 yrs <i class="fa fa-baby"></i></button>
      <button class="chip" data-filter="4-5">4–5 yrs <i class="fa fa-child"></i></button>
      <button class="chip" data-filter="5-6">5–6 yrs <i class="fa fa-child"></i></button>
      <button class="chip" data-filter="6-7">6–7 yrs <i class="fa fa-child"></i></button>
      <button class="chip" data-filter="7-8">7–8 yrs <i class="fa fa-child"></i></button>
      <button class="chip" data-filter="8-9">8–9 yrs <i class="fa fa-child"></i></button>
      <button class="chip" data-filter="9-10">9–10 yrs <i class="fa fa-child"></i></button>
      <button class="chip" data-filter="10-12">10–12 yrs <i class="fa fa-teen"></i></button>
      <button class="chip" data-filter="adult">Adult <i class="fa fa-user"></i></button>
    </div>
  </div>
</section>

<!-- SHOP / PRODUCT GRID -->
<section id="shop" class="shop container" aria-labelledby="shop-heading">
  <div class="shop-header">
    <h2 id="shop-heading"><i class="fa fa-store"></i> Shop Dresses</h2>
    <div class="shop-controls">
      <div class="search-wrap">
        <input id="search-input" type="search" placeholder="Search by name, color or id..." aria-label="Search products">
        <button id="search-clear" class="icon-btn" aria-label="Clear search"><i class="fa fa-times"></i></button>
      </div>

      <div class="sort-wrap">
        <label for="sort-select" class="sr-only">Sort</label>
        <select id="sort-select" aria-label="Sort products">
          <option value="featured">Featured</option>
          <option value="newest">Newest</option>
          <option value="price-asc">Price: Low → High</option>
          <option value="price-desc">Price: High → Low</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Product grid will be populated by JS from the products array.
       Start: empty container so your JS can inject 50 products.
       data-total-products is informative for the script. -->
  <div id="product-grid" class="product-grid" data-total-products="50" aria-live="polite">
    <!-- JS will inject product cards here using the template below -->
  </div>

  <!-- Load more to reveal more products in batches of 10 -->
  <div class="load-more-wrap">
    <button id="load-more" class="btn" aria-controls="product-grid" aria-label="Load more products">
      More dresses <i class="fa fa-chevron-down"></i>
    </button>
  </div>
</section>

<!-- PRODUCT CARD TEMPLATE (to be cloned by JS) -->
<template id="product-card-template">
  <article class="product-card" role="article" aria-label="Product">
    <div class="product-media">
      <button class="quickview" data-action="open-modal" aria-label="Quick view product">
        <i class="fa fa-search-plus"></i>
      </button>
      <img src="" alt="" class="product-image" />
      <div class="product-tag">
        <span class="tag-text">One-of-a-kind</span>
        <i class="fa fa-tag"></i>
      </div>
    </div>

    <div class="product-body">
      <h3 class="product-title"></h3>
      <p class="product-meta">
        <span class="product-size"></span>
        <span class="product-id"></span>
      </p>
      <div class="product-bottom">
        <div class="price-wrap">
          <span class="price"></span>
        </div>
        <div class="card-actions">
          <button class="btn tiny add-cart" data-action="add-to-cart" aria-label="Add to cart">
            <i class="fa fa-shopping-cart"></i> Add
          </button>
          <button class="btn outline tiny more-info" data-action="more-info" aria-label="More details">
            <i class="fa fa-info-circle"></i> More
          </button>
        </div>
      </div>
    </div>
  </article>
</template>

<!-- PRODUCT QUICK-VIEW / DETAILS MODAL -->
<div id="product-modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="modal-title">
  <div class="modal-inner">
    <button class="modal-close" aria-label="Close product" data-action="close-modal">
      <i class="fa fa-times"></i>
    </button>

    <div class="modal-grid">
      <div class="modal-media">
        <div class="gallery" id="modal-gallery" aria-live="polite">
          <!-- JS will fill with <img> thumbnails and main image -->
        </div>
        <div class="gallery-thumbs" id="modal-thumbs">
          <!-- thumbnails -->
        </div>
      </div>

      <div class="modal-info">
        <h2 id="modal-title" class="modal-title"></h2>
        <p class="modal-id"></p>

        <div class="price-row">
          <div class="modal-price"></div>
          <div class="availability"><i class="fa fa-check-circle"></i> In stock</div>
        </div>

        <p class="modal-desc"></p>

        <div class="modal-controls">
          <label for="modal-size">Size</label>
          <select id="modal-size" name="size" aria-label="Choose size">
            <option value="">Select size</option>
          </select>

          <label for="modal-qty">Qty</label>
          <input id="modal-qty" type="number" min="1" value="1" aria-label="Quantity" />

          <div class="modal-cta">
            <button id="modal-add" class="btn large" data-action="add-to-cart-modal">
              <i class="fa fa-shopping-cart"></i> Add to cart
            </button>

            <button id="modal-buy" class="btn accent" data-action="checkout-now">
              <i class="fa fa-credit-card"></i> Buy now
            </button>
          </div>
        </div>

        <div class="modal-meta">
          <small><i class="fa fa-calendar"></i> Unique piece ID: <span class="meta-id"></span></small>
          <small><i class="fa fa-star"></i> Handmade details</small>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- CART PANEL (slide-out) -->
<aside id="cart-panel" class="cart-panel" aria-hidden="true" role="region" aria-label="Shopping cart">
  <div class="cart-header">
    <h3><i class="fa fa-shopping-cart"></i> Your Cart</h3>
    <button class="cart-close icon-btn" aria-label="Close cart" data-action="close-cart"><i class="fa fa-times"></i></button>
  </div>

  <div id="cart-contents" class="cart-contents">
    <!-- JS will inject cart items here -->
    <div class="cart-empty">
      <i class="fa fa-box-open fa-3x"></i>
      <p>Your cart is empty. Add a dress you love!</p>
    </div>
  </div>

  <div class="cart-footer">
    <div class="cart-summary">
      <div class="subtotal">
        <span>Subtotal</span>
        <strong id="cart-subtotal">₵0.00</strong>
      </div>
    </div>

    <div class="cart-actions">
      <!-- Paystack will be handled via frontend JS on checkout -->
      <button id="checkout-btn" class="btn large checkout" data-action="checkout" aria-label="Checkout with Paystack">
        <i class="fa fa-credit-card"></i> Checkout (Paystack)
      </button>
      <button id="clear-cart" class="btn outline" data-action="clear-cart" aria-label="Clear cart">
        <i class="fa fa-trash"></i> Clear
      </button>
    </div>
  </div>
</aside>

<!-- CONTACT SECTION -->
<section id="contact" class="contact container" aria-labelledby="contact-heading">
  <h2 id="contact-heading"><i class="fa fa-envelope-open"></i> Get in touch</h2>
  <div class="contact-grid">
    <div class="contact-card">
      <h3>Questions?</h3>
      <p>Send us a message about sizing, fabric or custom orders.</p>
      <ul class="contact-list">
        <li><i class="fa fa-phone"></i> <a href="tel:+233000000000">+233 000 000 000</a></li>
        <li><i class="fa fa-whatsapp"></i> <a href="#">WhatsApp</a></li>
        <li><i class="fa fa-envelope"></i> <a href="mailto:hello@tinythreads.example">hello@tinythreads.example</a></li>
      </ul>
    </div>

    <form id="contact-form" class="contact-form" aria-label="Contact form" novalidate>
      <div class="form-row">
        <label for="name">Name</label>
        <input id="name" name="name" type="text" placeholder="Your name" required />
      </div>

      <div class="form-row">
        <label for="email">Email</label>
        <input id="email" name="email" type="email" placeholder="you@example.com" required />
      </div>

      <div class="form-row">
        <label for="message">Message</label>
        <textarea id="message" name="message" rows="4" placeholder="Ask about a dress, sizing, or restocks..." required></textarea>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn"><i class="fa fa-paper-plane"></i> Send message</button>
        <button type="reset" class="btn outline"><i class="fa fa-eraser"></i> Reset</button>
      </div>
    </form>
  </div>
</section>

<!-- ABOUT / SHOP INFO -->
<section id="about" class="about container" aria-labelledby="about-heading">
  <h2 id="about-heading"><i class="fa fa-info-circle"></i> About Tiny Threads</h2>
  <p class="lead">We make one-off dresses for children and small adults — lovingly crafted and limited in quantity. Each piece is photographed and listed as a single item. When it’s sold, it’s removed from the shop so you know you’re getting something unique.</p>

  <ul class="features-grid">
    <li><i class="fa fa-hand-paper"></i> Ethically made</li>
    <li><i class="fa fa-seedling"></i> Natural fabrics</li>
    <li><i class="fa fa-truck"></i> Fast local shipping</li>
    <li><i class="fa fa-star"></i> Unique designs</li>
  </ul>
</section>
```

  </main>

  <!-- STACKED FOOTER -->

  <footer class="site-footer" role="contentinfo">
    <div class="footer-top container">
      <div class="footer-col">
        <a class="footer-logo" href="#"><i class="fa fa-heart"></i> Tiny Threads</a>
        <p>One-of-a-kind kids dresses. Small batches, big smiles.</p>
        <div class="socials">
          <a href="#" aria-label="Instagram"><i class="fa fa-instagram"></i></a>
          <a href="#" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
          <a href="#" aria-label="TikTok"><i class="fa fa-music"></i></a>
        </div>
      </div>


  <div class="footer-col">
    <h4>Quick links</h4>
    <ul>
      <li><a href="#shop"><i class="fa fa-angle-right"></i> Shop</a></li>
      <li><a href="#about"><i class="fa fa-angle-right"></i> About</a></li>
      <li><a href="#contact"><i class="fa fa-angle-right"></i> Contact</a></li>
      <li><a href="admin.html"><i class="fa fa-angle-right"></i> Admin (private)</a></li>
    </ul>
  </div>

  <div class="footer-col">
    <h4>Newsletter</h4>
    <p>Get new dress drops and restock alerts.</p>
    <form id="newsletter" class="newsletter-form" aria-label="Newsletter sign up">
      <input type="email" placeholder="you@example.com" aria-label="Email for newsletter" />
      <button type="submit" class="btn tiny"><i class="fa fa-paper-plane"></i> Subscribe</button>
    </form>
  </div>
</div>

<div class="footer-bottom container">
  <small>&copy; <span id="year"></span> Tiny Threads — All rights reserved.</small>
  <ul class="legal">
    <li><a href="#">Terms</a></li>
    <li><a href="#">Privacy</a></li>
  </ul>
</div>
```

  </footer>

  <!-- TEMPLATES FOR CART ITEMS -->

  <template id="cart-item-template">
    <div class="cart-item" data-product-id="">
      <img src="" alt="" class="cart-item-thumb" />
      <div class="cart-item-info">
        <strong class="cart-item-title"></strong>
        <small class="cart-item-meta"></small>
        <div class="cart-item-actions">
          <input type="number" min="1" value="1" class="cart-item-qty" />
          <button class="icon-btn cart-item-remove" aria-label="Remove item"><i class="fa fa-trash"></i></button>
        </div>
      </div>
      <div class="cart-item-price"><strong class="item-price"></strong></div>
    </div>
  </template>

  <!-- SCRIPT: interactive behaviour, products, cart, modal, hero, filters, Paystack checkout -->
<script>
  
/* ========== CONFIG ========== */
const PAYSTACK_PUBLIC_KEY = 'YOUR_PAYSTACK_PUBLIC_KEY_HERE'; // <-- set this
const STORAGE_KEYS = {
  PRODUCTS: 'tiny_products_v1',
  CART: 'tiny_cart_v1',
  ORDERS: 'tiny_orders_v1'
};
const PRODUCTS_TOTAL = 50; // expected count (generated below if not in storage)
const LOAD_BATCH = 10;

/* ========== UTIL ========== */
const $ = (sel, el = document) => el.querySelector(sel);
const $$ = (sel, el = document) => Array.from(el.querySelectorAll(sel));
const formatPrice = (p) => `₵${Number(p).toFixed(2)}`;
const nowISO = () => new Date().toISOString();

/* Simple toast for feedback */
function toast(msg, timeout = 2500) {
  let t = document.createElement('div');
  t.className = 'tiny-toast';
  t.textContent = msg;
  document.body.appendChild(t);
  requestAnimationFrame(() => t.classList.add('show'));
  setTimeout(() => {
    t.classList.remove('show');
    setTimeout(() => t.remove(), 300);
  }, timeout);
}

/* ========== DATA: products array generator (replace images & data with real ones) ========== */
function generateProducts(n = PRODUCTS_TOTAL) {
  const ageCats = ['0-3','4-5','5-6','6-7','7-8','8-9','9-10','10-12','adult'];
  const sizesByCat = {
    '0-3': ['0-3M','3-6M','6-12M'],
    '4-5': ['4','5'],
    '5-6': ['5','6'],
    '6-7': ['6','7'],
    '7-8': ['7','8'],
    '8-9': ['8','9'],
    '9-10': ['9','10'],
    '10-12': ['10','12'],
    'adult': ['S','M','L']
  };

  const arr = [];
  for (let i = 1; i <= n; i++) {
    const cat = ageCats[(i - 1) % ageCats.length];
    const id = `DRESS-${String(i).padStart(3, '0')}`;
    const title = `Delicate Dress ${i}`;
    const price = (Math.round((15 + (i % 20) * 2 + Math.random() * 10) * 100) / 100); // variety
    const imgs = [
      `images/dress-${i}.jpg`,
      `images/dress-${i}-2.jpg`,
      `images/dress-${i}-3.jpg`
    ]; // replace these with actual images you uploaded
    arr.push({
      id,
      title,
      price,
      description: `One-of-a-kind handmade dress — model ${i}. Lovely fabric, great for special days.`,
      sizes: sizesByCat[cat].slice(),
      ageCategory: cat, // use same filter keys as chips data-filter
      images: imgs,
      available: true,
      createdAt: new Date(Date.now() - i * 86400000).toISOString() // spaced created dates
    });
  }
  return arr;
}

/* ========== PERSISTENCE ========== */
function saveProducts(products) {
  localStorage.setItem(STORAGE_KEYS.PRODUCTS, JSON.stringify(products));
}
function loadProducts() {
  const raw = localStorage.getItem(STORAGE_KEYS.PRODUCTS);
  if (!raw) {
    const prod = generateProducts(PRODUCTS_TOTAL);
    saveProducts(prod);
    return prod;
  }
  try {
    return JSON.parse(raw);
  } catch(e) {
    const prod = generateProducts(PRODUCTS_TOTAL);
    saveProducts(prod);
    return prod;
  }
}

function saveCart(cart) {
  localStorage.setItem(STORAGE_KEYS.CART, JSON.stringify(cart));
}
function loadCart() {
  const raw = localStorage.getItem(STORAGE_KEYS.CART);
  return raw ? JSON.parse(raw) : [];
}

function pushOrder(order) {
  const raw = localStorage.getItem(STORAGE_KEYS.ORDERS);
  const arr = raw ? JSON.parse(raw) : [];
  arr.unshift(order);
  localStorage.setItem(STORAGE_KEYS.ORDERS, JSON.stringify(arr));
}

/* ========== APP STATE ========== */
let products = loadProducts();
let cart = loadCart();
let currentBatchIndex = 0; // each batch = LOAD_BATCH; used by load more
let activeFilters = { ageCategory: null, search: '', sort: 'featured' };

/* ========== RENDER: products ========== */
const productGrid = $('#product-grid');
const productTemplate = $('#product-card-template').content;

function clearGrid() {
  productGrid.innerHTML = '';
}

function createProductCard(product) {
  const node = document.importNode(productTemplate, true);
  const art = node.querySelector('.product-card');
  art.dataset.productId = product.id;

  const img = node.querySelector('.product-image');
  img.src = product.images[0] || '';
  img.alt = product.title;

  node.querySelector('.product-title').textContent = product.title;
  node.querySelector('.product-size').textContent = product.sizes.join(' • ');
  node.querySelector('.product-id').textContent = product.id;
  node.querySelector('.price').textContent = formatPrice(product.price);

  const addBtn = node.querySelector('[data-action="add-to-cart"]');
  const moreBtn = node.querySelector('.more-info');
  const quickBtn = node.querySelector('[data-action="open-modal"]');

  if (!product.available) {
    art.classList.add('sold-out');
    node.querySelector('.product-tag .tag-text').textContent = 'Sold';
    addBtn.disabled = true;
    addBtn.textContent = 'Sold';
  }

  addBtn.addEventListener('click', (e) => {
    e.preventDefault();
    addToCart(product.id);
  });
  moreBtn.addEventListener('click', (e) => {
    e.preventDefault();
    openProductModal(product.id);
  });
  quickBtn.addEventListener('click', (e) => {
    e.preventDefault();
    openProductModal(product.id);
  });

  return node;
}

/* Render visibleProducts up to currentBatchIndex * LOAD_BATCH */
function getFilteredSortedProducts() {
  let list = products.slice();

  // filter by availability (only show available)
  list = list.filter(p => p.available);

  // filter by category
  if (activeFilters.ageCategory) {
    list = list.filter(p => p.ageCategory === activeFilters.ageCategory);
  }

  // search
  const q = (activeFilters.search || '').trim().toLowerCase();
  if (q) {
    list = list.filter(p => 
      p.title.toLowerCase().includes(q) ||
      p.id.toLowerCase().includes(q) ||
      p.description.toLowerCase().includes(q)
    );
  }

  // sort
  switch (activeFilters.sort) {
    case 'newest':
      list.sort((a,b) => new Date(b.createdAt) - new Date(a.createdAt));
      break;
    case 'price-asc':
      list.sort((a,b) => a.price - b.price);
      break;
    case 'price-desc':
      list.sort((a,b) => b.price - a.price);
      break;
    default:
      // featured: leave as is (created order)
      break;
  }

  return list;
}

function renderProductsBatch(reset = false) {
  if (reset) {
    currentBatchIndex = 0;
    productGrid.innerHTML = '';
  }
  const filtered = getFilteredSortedProducts();
  const start = currentBatchIndex * LOAD_BATCH;
  const end = start + LOAD_BATCH;
  const batch = filtered.slice(start, end);

  if (batch.length === 0 && start === 0) {
    productGrid.innerHTML = `<div class="no-results"><i class="fa fa-frown"></i><p>No dresses found.</p></div>`;
  }

  batch.forEach(p => {
    const node = createProductCard(p);
    productGrid.appendChild(node);
  });

  currentBatchIndex++;
  // show/hide load more
  const loadMore = $('#load-more');
  if (end >= filtered.length) {
    loadMore.style.display = 'none';
  } else {
    loadMore.style.display = 'inline-block';
  }
}

/* ========== FILTERS / SEARCH / SORT UI ========== */
const chips = $$('.category-chips .chip');
chips.forEach(chip => {
  chip.addEventListener('click', (e) => {
    const key = chip.dataset.filter;
    // toggle
    if (activeFilters.ageCategory === key) {
      activeFilters.ageCategory = null;
      chip.classList.remove('active');
    } else {
      activeFilters.ageCategory = key;
      // reset others
      chips.forEach(c => c.classList.remove('active'));
      chip.classList.add('active');
    }
    renderProductsBatch(true);
  });
});

$('#search-input').addEventListener('input', (e) => {
  activeFilters.search = e.target.value;
  // quick debounce
  clearTimeout(window.__searchTimer);
  window.__searchTimer = setTimeout(() => renderProductsBatch(true), 220);
});
$('#search-clear').addEventListener('click', () => {
  $('#search-input').value = '';
  activeFilters.search = '';
  renderProductsBatch(true);
});

$('#sort-select').addEventListener('change', (e) => {
  activeFilters.sort = e.target.value;
  renderProductsBatch(true);
});

$('#load-more').addEventListener('click', (e) => {
  e.preventDefault();
  renderProductsBatch(false);
});

/* ========== PRODUCT MODAL ========== */
const modal = $('#product-modal');
const modalGallery = $('#modal-gallery');
const modalThumbs = $('#modal-thumbs');
const modalTitle = $('#modal-title');
const modalPrice = $('.modal-price');
const modalDesc = $('.modal-desc');
const modalIdSpan = $('.meta-id');
const modalSizeSelect = $('#modal-size');
const modalQty = $('#modal-qty');
let modalCurrentProduct = null;

function openProductModal(productId) {
  const p = products.find(x => x.id === productId);
  if (!p) return;
  modalCurrentProduct = p;

  // gallery
  modalGallery.innerHTML = '';
  modalThumbs.innerHTML = '';
  p.images.forEach((src, idx) => {
    const mainImg = document.createElement('img');
    mainImg.src = src;
    mainImg.alt = `${p.title} image ${idx+1}`;
    mainImg.className = 'modal-main-img';
    mainImg.dataset.idx = idx;
    if (idx !== 0) mainImg.style.display = 'none';
    modalGallery.appendChild(mainImg);

    const t = document.createElement('img');
    t.src = src;
    t.alt = `thumb ${idx+1}`;
    t.className = 'thumb';
    t.dataset.idx = idx;
    t.addEventListener('click', () => {
      // swap gallery
      $$('.modal-main-img', modalGallery).forEach(img => img.style.display = 'none');
      modalGallery.querySelector(`img[data-idx="${idx}"]`).style.display = '';
    });
    modalThumbs.appendChild(t);
  });

  modalTitle.textContent = p.title;
  modalPrice.textContent = formatPrice(p.price);
  modalDesc.textContent = p.description;
  modalIdSpan.textContent = p.id;

  // sizes
  modalSizeSelect.innerHTML = `<option value="">Select size</option>`;
  p.sizes.forEach(s => {
    const o = document.createElement('option');
    o.value = s;
    o.textContent = s;
    modalSizeSelect.appendChild(o);
  });

  modalQty.value = 1;

  // availability
  if (!p.available) {
    $('.availability', modal).textContent = 'Sold';
    $('#modal-add').disabled = true;
    $('#modal-buy').disabled = true;
  } else {
    $('.availability', modal).textContent = 'In stock';
    $('#modal-add').disabled = false;
    $('#modal-buy').disabled = false;
  }

  modal.setAttribute('aria-hidden', 'false');
  modal.classList.add('open');
}

function closeProductModal() {
  modal.setAttribute('aria-hidden', 'true');
  modal.classList.remove('open');
  modalCurrentProduct = null;
}

document.addEventListener('click', (e) => {
  if (e.target.matches('[data-action="close-modal"]') || e.target.closest('#product-modal .modal-close')) {
    closeProductModal();
  }
});
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') closeProductModal();
});

/* Modal add to cart + buy now */
$('#modal-add').addEventListener('click', () => {
  if (!modalCurrentProduct) return;
  const size = modalSizeSelect.value;
  if (!size) { toast('Please choose a size'); return; }
  addToCart(modalCurrentProduct.id, Number(modalQty.value || 1), size);
  closeProductModal();
});

$('#modal-buy').addEventListener('click', () => {
  if (!modalCurrentProduct) return;
  const size = modalSizeSelect.value;
  if (!size) { toast('Please choose a size'); return; }
  // temporarily ensure cart has only this item
  const single = { id: modalCurrentProduct.id, qty: Number(modalQty.value || 1), size };
  startCheckout([single]);
});

/* ========== CART ========== */
const cartPanel = $('#cart-panel');
const cartBadge = $('#cart-badge');
const cartContents = $('#cart-contents');
const cartSubtotalEl = $('#cart-subtotal');

function updateCartUI() {
  // rebuild cart panel
  cartContents.innerHTML = '';
  if (cart.length === 0) {
    cartContents.innerHTML = `<div class="cart-empty">
      <i class="fa fa-box-open fa-3x"></i>
      <p>Your cart is empty. Add a dress you love!</p>
    </div>`;
    cartBadge.textContent = 0;
    cartSubtotalEl.textContent = '₵0.00';
    return;
  }

  cartBadge.textContent = cart.length;

  cart.forEach(item => {
    const prod = products.find(p => p.id === item.id) || {};
    const tpl = $('#cart-item-template').content.cloneNode(true);
    const el = tpl.querySelector('.cart-item');
    el.dataset.productId = item.id;
    el.querySelector('.cart-item-thumb').src = (prod.images && prod.images[0]) || '';
    el.querySelector('.cart-item-title').textContent = prod.title || item.id;
    el.querySelector('.cart-item-meta').textContent = `${item.size || ''} • ${prod.id || ''}`;
    el.querySelector('.cart-item-qty').value = item.qty;
    el.querySelector('.item-price').textContent = formatPrice((prod.price || 0) * item.qty);

    // qty change
    el.querySelector('.cart-item-qty').addEventListener('change', (e) => {
      const v = Number(e.target.value || 1);
      if (v < 1) e.target.value = 1;
      const idx = cart.findIndex(c => c.id === item.id);
      if (idx >= 0) {
        cart[idx].qty = Number(e.target.value);
        saveCart(cart);
        updateCartUI();
      }
    });

    // remove
    el.querySelector('.cart-item-remove').addEventListener('click', () => {
      removeFromCart(item.id);
      updateCartUI();
    });

    cartContents.appendChild(el);
  });

  // subtotal
  const subtotal = cart.reduce((s, it) => {
    const prod = products.find(p => p.id === it.id);
    return s + (prod ? prod.price * it.qty : 0);
  }, 0);
  cartSubtotalEl.textContent = formatPrice(subtotal);
}

function addToCart(productId, qty = 1, size = '') {
  // ensure product exists and available
  const p = products.find(x => x.id === productId);
  if (!p || !p.available) {
    toast('Sorry — this dress is no longer available.');
    return;
  }
  // ensure not already in cart (one-of-a-kind)
  if (cart.some(c => c.id === productId)) {
    toast('This dress is already in your cart.');
    return;
  }
  // if size not provided and product has sizes, prompt user via modal
  if (!size && p.sizes && p.sizes.length) {
    openProductModal(productId);
    toast('Please choose a size.');
    return;
  }
  const item = { id: productId, qty: Math.max(1, Number(qty)), size };
  cart.push(item);
  saveCart(cart);
  updateCartUI();
  toast('Added to cart');
  // optionally open cart
  openCart();
}

function removeFromCart(productId) {
  cart = cart.filter(c => c.id !== productId);
  saveCart(cart);
  updateCartUI();
}

/* CART panel toggles */
$('#cart-toggle').addEventListener('click', () => {
  const open = cartPanel.getAttribute('aria-hidden') === 'false';
  if (open) closeCart(); else openCart();
});

function openCart() {
  cartPanel.setAttribute('aria-hidden', 'false');
  cartPanel.classList.add('open');
  updateCartUI();
}
function closeCart() {
  cartPanel.setAttribute('aria-hidden', 'true');
  cartPanel.classList.remove('open');
}
document.querySelectorAll('[data-action="close-cart"]').forEach(btn => {
  btn.addEventListener('click', closeCart);
});

/* Clear cart */
$('#clear-cart').addEventListener('click', (e) => {
  e.preventDefault();
  cart = [];
  saveCart(cart);
  updateCartUI();
  toast('Cart cleared');
});

/* ========== CHECKOUT (Paystack frontend-only) ========== */
$('#checkout-btn').addEventListener('click', (e) => {
  e.preventDefault();
  if (cart.length === 0) { toast('Your cart is empty'); return; }
  startCheckout(cart);
});

/* Prepare a simple checkout flow. `items` is an array of {id, qty, size} */
function startCheckout(items) {
  // basic buyer prompt for email (simplified)
  const buyerEmail = prompt('Enter buyer email for receipt and payment (required):');
  if (!buyerEmail || !buyerEmail.includes('@')) { toast('Valid email required'); return; }

  // compute total
  const total = items.reduce((s, it) => {
    const p = products.find(pp => pp.id === it.id);
    return s + (p ? p.price * it.qty : 0);
  }, 0);

  // guard: ensure items still available
  for (const it of items) {
    const p = products.find(pp => pp.id === it.id);
    if (!p || !p.available) {
      toast(`${it.id} is no longer available`);
      return;
    }
  }

  // Paystack inline flow
  if (!window.PaystackPop || !PAYSTACK_PUBLIC_KEY || PAYSTACK_PUBLIC_KEY === 'YOUR_PAYSTACK_PUBLIC_KEY_HERE') {
    // fallback: simulate payment success (for dev) OR instruct to include key
    const proceed = confirm('Paystack is not configured. Click OK to simulate a successful payment (dev mode). Cancel to abort.');
    if (!proceed) return;
    // simulate success:
    const fakeRef = 'SIM-' + Math.random().toString(36).slice(2, 10).toUpperCase();
    handleSuccessfulPayment(fakeRef, buyerEmail, items, total);
    return;
  }

  const amountMinor = Math.round(total * 100); // multiply to smallest unit (adjust if needed)
  const handler = PaystackPop.setup({
    key: PAYSTACK_PUBLIC_KEY,
    email: buyerEmail,
    amount: amountMinor,
    metadata: {
      custom_fields: [
        { display_name: "Cart items", variable_name: "cart", value: JSON.stringify(items) }
      ]
    },
    onClose: function() {
      toast('Payment window closed');
    },
    callback: function(response) {
      // response.reference
      handleSuccessfulPayment(response.reference, buyerEmail, items, total);
    }
  });
  handler.openIframe();
}

/* handle successful payment:
   - mark products unavailable
   - create order in localStorage (so admin.html can show orders)
   - clear cart (or remove items purchased)
   - update UI
*/
function handleSuccessfulPayment(reference, buyerEmail, items, total) {
  // mark items as sold
  items.forEach(it => {
    const prod = products.find(p => p.id === it.id);
    if (prod) prod.available = false;
  });
  saveProducts(products);

  // create order record
  const order = {
    reference,
    buyerEmail,
    items,
    total,
    paidAt: nowISO(),
    status: 'paid'
  };
  pushOrder(order);

  // remove purchased items from cart
  const purchasedIds = items.map(i => i.id);
  cart = cart.filter(c => !purchasedIds.includes(c.id));
  saveCart(cart);

  // reflect changes in UI
  updateCartUI();
  renderProductsBatch(true); // re-render grid (sold items removed)
  closeCart();
  closeProductModal();

  toast('Payment successful — thank you!');
  // you might want to open admin.html or notify owner externally; admin will read orders from localStorage
}

/* ========== HERO SLIDESHOW ========== */
(function heroInit(){
  const slider = document.querySelector('.hero-slider');
  if (!slider) return;
  const slides = $$('.hero-slider .slide');
  const dotsWrap = $('.hero-dots');
  let idx = 0;
  const total = slides.length;
  let timer = null;
  function show(i) {
    slides.forEach(s => s.classList.remove('active'));
    slides.forEach(s => s.style.display = 'none');
    slides[i].style.display = '';
    slides[i].classList.add('active');
    // dots
    dotsWrap.innerHTML = '';
    for (let d = 0; d < total; d++) {
      const b = document.createElement('button');
      b.className = 'dot' + (d === i ? ' active' : '');
      b.setAttribute('aria-label', `Go to slide ${d+1}`);
      b.addEventListener('click', () => {
        idx = d; resetTimer(); show(idx);
      });
      dotsWrap.appendChild(b);
    }
  }
  function next() { idx = (idx + 1) % total; show(idx); }
  function prev() { idx = (idx - 1 + total) % total; show(idx); }
  $('.hero-next').addEventListener('click', (e)=>{ e.preventDefault(); resetTimer(); next(); });
  $('.hero-prev').addEventListener('click', (e)=>{ e.preventDefault(); resetTimer(); prev(); });

  function resetTimer() {
    if (timer) clearInterval(timer);
    timer = setInterval(next, 4000);
  }
  show(0);
  resetTimer();
})();

/* ========== MOBILE NAV / HAMBURGER ========== */
$('#mobile-toggle').addEventListener('click', () => {
  const mobileNav = $('#mobile-nav');
  const expanded = $('#mobile-toggle').getAttribute('aria-expanded') === 'true';
  $('#mobile-toggle').setAttribute('aria-expanded', (!expanded).toString());
  if (expanded) {
    mobileNav.setAttribute('aria-hidden','true');
    mobileNav.classList.remove('open');
  } else {
    mobileNav.setAttribute('aria-hidden','false');
    mobileNav.classList.add('open');
  }
});

/* Close mobile nav when clicking a link */
$$('#mobile-nav a').forEach(a => a.addEventListener('click', () => {
  $('#mobile-toggle').setAttribute('aria-expanded','false');
  $('#mobile-nav').setAttribute('aria-hidden','true');
  $('#mobile-nav').classList.remove('open');
}));

/* ========== INIT ========== */
function init() {
  // year in footer
  const y = new Date().getFullYear();
  document.getElementById('year').textContent = y;

  // initial render
  // ensure products variable is in memory (loaded earlier)
  saveProducts(products); // ensure persisted structure exists
  renderProductsBatch(true);

  // cart UI
  updateCartUI();

  // admin link: open in new tab
  document.querySelectorAll('a[href="admin.html"]').forEach(a => a.setAttribute('target','_blank'));

  // contact form basic handler (no server: just toast)
  const contactForm = $('#contact-form');
  contactForm.addEventListener('submit', (e) => {
    e.preventDefault();
    toast('Thanks! Message sent (client demo). Owner will need server/email to actually receive messages.');
    contactForm.reset();
  });

  // newsletter
  $('#newsletter')?.addEventListener('submit', (e) => {
    e.preventDefault();
    const em = $('#newsletter input[type="email"]')?.value;
    if (!em || !em.includes('@')) { toast('Provide a valid email'); return; }
    toast('Subscribed (demo). Add a backend to store emails.');
    $('#newsletter').reset();
  });
}
document.addEventListener('DOMContentLoaded', init);



</script>


</body>
</html>
