<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>MushRush â€” Early Access (Polished)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{
--bg-900:#05020a;
--panel:#0b0910;
--muted:rgba(255,255,255,0.92);
--muted-2:rgba(255,255,255,0.62);
--purple-800:#3b0f78;
--purple-700:#5b21a6;
--purple-500:#8b5cf6;
--purple-300:#c6a6ff;
--accent:#ff6fcf;
--success:#22c55e;
--glass:rgba(255,255,255,0.04);
--card-radius:14px;
--shadow-lg: 0 20px 50px rgba(6,8,20,0.7);
--focus: rgba(139,92,246,0.16);
}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#03010a 0%, #06020b 100%);color:#eef2ff;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;overflow:hidden}
body::before{content:'';position:fixed;inset:0;background-image:radial-gradient(rgba(255,255,255,0.004) 1px, transparent 1px);background-size:8px 8px;mix-blend-mode:overlay;opacity:.6;pointer-events:none}

/* design canvas auto-fit */
.stage-wrap{width:1280px;height:760px;margin:0 auto;transform-origin:top center;display:flex;align-items:center;justify-content:center}
.stage{width:1240px;height:720px;padding:22px;box-sizing:border-box;display:grid;grid-template-columns:1fr 480px;gap:28px;border-radius:18px;background:linear-gradient(180deg, rgba(255,255,255,0.012), rgba(255,255,255,0.006));border:1px solid var(--glass);box-shadow:var(--shadow-lg)}

/* LEFT column */
.left{display:flex;flex-direction:column;gap:14px;padding:10px}
.header{display:flex;align-items:center;gap:12px}
.logo{width:56px;height:46px;border-radius:12px;background:linear-gradient(135deg,var(--purple-700),var(--purple-500));display:flex;align-items:center;justify-content:center;font-weight:800}
.title{font-weight:700}
.subtitle{font-size:13px;color:var(--muted-2)}

.h1{font-family:Space Mono,monospace;font-weight:800;letter-spacing:1px;color:var(--purple-300);font-size:28px}
.lead{color:var(--muted);max-width:640px}

.ref-block{display:flex;flex-direction:column;gap:8px;margin-top:8px}
.ref-required{color:var(--muted-2);font-size:13px}
.input-row{display:flex;gap:10px;align-items:center}
.input{flex:1;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;font-weight:600}
.btn-apply{padding:10px 14px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--purple-700),var(--purple-500));color:white;font-weight:800;cursor:pointer}

/* TASKS area (left) */
.tasks{margin-top:12px;display:flex;flex-direction:column;gap:12px}
.task-row{display:flex;align-items:center;justify-content:space-between;padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.012), transparent);border:1px solid rgba(255,255,255,0.02)}
.task-left{display:flex;align-items:center;gap:12px}
.task-dot{width:14px;height:14px;border-radius:50%;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.03)}
.task-dot.task-done{background:var(--success);border-color:rgba(0,0,0,0.06)}
.task-label{font-weight:700}

/* PURPLE task buttons (unified) */
.btn-task{padding:10px 14px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--purple-700),var(--purple-500));color:white;font-weight:800;cursor:pointer;box-shadow:0 8px 20px rgba(91,33,166,0.12)}
.btn-task.small{padding:8px 12px;font-weight:700}
.btn-task.done{background:linear-gradient(90deg,#22c55e,#7ee6a6);box-shadow:0 8px 20px rgba(34,197,94,0.12);color:#04220f}

.progress{margin-top:6px;text-align:left;color:var(--muted);font-weight:700}

/* MAIN CTA styles (distinct but cohesive) */
.cta-row{display:flex;gap:12px;margin-top:8px}
.btn-cta-primary{padding:12px 16px;border-radius:12px;border:0;background:linear-gradient(90deg,var(--purple-700),var(--purple-300));color:white;font-weight:900;cursor:pointer;box-shadow:0 14px 36px rgba(91,33,166,0.12)}
.btn-cta-primary[disabled]{opacity:.5;cursor:not-allowed}
.btn-cta-secondary{padding:12px 16px;border-radius:12px;border:2px solid rgba(255,255,255,0.06);background:transparent;color:var(--purple-300);font-weight:900;cursor:pointer}

/* RIGHT column: player card with image container like screenshot */
.right{display:flex;flex-direction:column;gap:12px}
.card{border-radius:14px;padding:14px;background:linear-gradient(180deg, rgba(139,92,246,0.06), rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.04);box-shadow:0 20px 50px rgba(6,8,20,0.6)}

/* image container: rounded rectangle with large inset padding and subtle inset shadow (like screenshot) */
.image-frame{border-radius:14px;overflow:hidden;background:linear-gradient(180deg, var(--purple-300), var(--purple-500));padding:18px;display:flex;align-items:center;justify-content:center;box-shadow:inset 0 -18px 30px rgba(0,0,0,0.18), 0 12px 36px rgba(10,6,25,0.6)}
.image-card{width:100%;max-width:420px;border-radius:12px;background:#fff;padding:6px;box-shadow:0 18px 40px rgba(16,10,30,0.6);}
.image-card img{display:block;width:100%;height:auto;border-radius:8px}

.card-meta{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
.meta-left{color:var(--muted-2);font-weight:700}
.status{font-weight:900;color:white}

.card-tasks{margin-top:12px;padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.02)}
.card-tasks .task-row{background:transparent;border:0;padding:10px}

/* small helpers */
.muted{color:var(--muted)}
.hint{font-size:13px;color:var(--muted-2)}

button:focus,input:focus{outline:none;box-shadow:0 0 0 6px var(--focus);border-radius:10px}

/* Close & Download variants (keeps consistency with theme) */
.icon-btn {
width:42px;
height:42px;
border-radius:10px;
display:inline-flex;
align-items:center;
justify-content:center;
background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
border:1px solid rgba(255,255,255,0.04);
color: #fff;
cursor:pointer;
transition: transform .14s ease, box-shadow .14s ease, background .12s ease;
}
.icon-btn:hover { transform: translateY(-3px); box-shadow: 0 12px 30px rgba(6,10,30,0.45); }
.icon-btn:active { transform: translateY(-1px); }
.icon-btn:focus { outline: none; box-shadow: 0 0 0 6px rgba(139,92,246,0.12); }

/* Close button: red-ish hint */
.icon-btn.close {
background: linear-gradient(180deg, rgba(255,80,80,0.06), rgba(255,40,40,0.02));
border-color: rgba(255,80,80,0.10);
color: #fff;
}

/* Download button: purple solid */
.icon-btn.download {
background: linear-gradient(90deg, #5b21a6, #8b5cf6);
border: 0;
color: #fff;
box-shadow: 0 10px 28px rgba(91,33,166,0.14);
}
.icon-btn svg { width:18px; height:18px; display:block; fill: currentColor; stroke: currentColor; }

/* overlay & toast & confetti */
.overlay {
position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(1,1,2,0.6), rgba(1,1,2,0.75));backdrop-filter:blur(6px);z-index:60;
}
.overlay-card{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));padding:22px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 30px 80px rgba(6,8,20,0.6);min-width:320px;color:var(--muted)}
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:36px;background:linear-gradient(90deg, rgba(0,0,0,0.45), rgba(0,0,0,0.35));padding:10px 14px;border-radius:10px;color:white;z-index:70;opacity:0;transition:opacity .18s ease}
.confetti-canvas{position:fixed;inset:0;pointer-events:none;z-index:75}

/* small responsive fallback */
@media (max-width:1220px){
.stage{width:100%;height:auto;grid-template-columns:1fr;gap:18px}
.stage-wrap{width:100%}
body{overflow:auto}
}

  /* =========== MushRush Auth Modal styles =========== */
:root{
  --mr-bg: #07040a;
  --mr-panel: rgba(255,255,255,0.03);
  --mr-muted: rgba(255,255,255,0.9);
  --mr-muted-2: rgba(255,255,255,0.62);
  --mr-purple-700: #5b21a6;
  --mr-purple-500: #8b5cf6;
  --mr-accent: #ff6fcf;
  --mr-success: #22c55e;
  --mr-radius: 14px;
  --mr-shadow: 0 24px 60px rgba(6,8,20,0.8);
  --mr-z: 9999;
}

.mr-auth-overlay { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: var(--mr-z); background: linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.6)); backdrop-filter: blur(6px); padding: 28px; }

.mr-auth-overlay[aria-hidden="false"] { display: flex; animation: mrFadeIn .18s ease both; }
@keyframes mrFadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }

.mr-auth-modal { width: 920px; max-width: calc(100% - 48px); background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius: var(--mr-radius); padding: 20px; box-shadow: var(--mr-shadow); border: 1px solid rgba(255,255,255,0.04); color: var(--mr-muted); position: relative; overflow: hidden; }

/* Close */
.mr-auth-close { position: absolute; right: 12px; top: 12px; background: transparent; border: 0; color: var(--mr-muted-2); font-size: 26px; width: 40px; height: 40px; border-radius: 10px; display: inline-flex; align-items:center; justify-content:center; cursor:pointer; }
.mr-auth-close:focus { outline: none; box-shadow: 0 0 0 6px rgba(139,92,246,0.12); }

/* grid */
.mr-auth-grid { display: grid; grid-template-columns: 1fr 360px; gap: 22px; align-items: stretch; }

/* Left */
.mr-auth-left { padding-right: 6px; }

.mr-brand { display:flex; gap:12px; align-items:center; margin-bottom: 8px; }
.mr-logo { width:52px; height:46px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-weight:900; color:white; background: linear-gradient(135deg, var(--mr-purple-700), var(--mr-purple-500)); box-shadow: 0 8px 26px rgba(91,33,166,0.12); font-family: 'Space Mono', monospace; font-size:20px; }
.mr-title { font-weight:800; font-size:18px; color: var(--mr-muted); }
.mr-sub { font-size:13px; color:var(--mr-muted-2); }

/* tabs */
.mr-tabs { display:flex; gap:8px; margin: 14px 0; }
.mr-tab { padding:10px 12px; border-radius:10px; background: transparent; color: var(--mr-muted-2); border: 1px solid transparent; font-weight:700; cursor:pointer; }
.mr-tab--active { background: linear-gradient(90deg, var(--mr-purple-700), var(--mr-purple-500)); color: white; border: 0; box-shadow: 0 12px 34px rgba(91,33,166,0.12); transform: translateY(-1px); }

/* oauth */
.mr-oauth-row { margin: 8px 0 4px 0; }
.mr-oauth { display:flex; align-items:center; gap:10px; width:100%; padding:12px; border-radius:12px; font-weight:800; cursor:pointer; border:0; }
.btn-x { background: linear-gradient(90deg,#1d9bf0,#0c7adf); color:white; box-shadow: 0 12px 34px rgba(13,93,168,0.12); }

/* divider */
.mr-divider { text-align:center; margin: 12px 0; position: relative; color: var(--mr-muted-2); font-weight:700; }
.mr-divider::before, .mr-divider::after { content: ''; height:1px; background: rgba(255,255,255,0.03); position:absolute; left:12px; right:12px; top:50%; z-index:-1; }
.mr-divider span { display:inline-block; padding:4px 12px; background: linear-gradient(180deg, rgba(0,0,0,0.02), rgba(0,0,0,0.02)); border-radius:999px; }

/* forms */
.mr-form { display:flex; flex-direction:column; gap:10px; margin-top:4px; }
.mr-label { display:flex; flex-direction:column; gap:8px; font-size:13px; color:var(--mr-muted-2); font-weight:700; }
.mr-input { padding:12px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background: transparent; color: var(--mr-muted); font-weight:700; }
.mr-input:focus { outline: none; box-shadow: 0 0 0 6px rgba(139,92,246,0.12); border-color: rgba(139,92,246,0.18); }

/* password strength */
.mr-strength { margin-top:6px; height:8px; background: rgba(255,255,255,0.03); border-radius:6px; overflow:hidden; }
.mr-strength-bar { display:block; height:100%; width:0%; background: linear-gradient(90deg, #ff8ab6, #8b5cf6); transition: width .28s ease; }

/* errors */
.mr-error { color: #ff9aa2; font-weight:800; font-size:13px; margin-top:6px; }

/* actions */
.mr-actions { display:flex; gap:10px; margin-top:8px; }
.mr-btn { padding:10px 14px; border-radius:10px; font-weight:900; cursor:pointer; border:0; }
.mr-btn-primary { background: linear-gradient(90deg,var(--mr-purple-700),var(--mr-purple-500)); color:white; box-shadow: 0 14px 38px rgba(91,33,166,0.12); flex:1; }
.mr-btn-ghost { background: transparent; border:1px solid rgba(255,255,255,0.04); color: var(--mr-muted-2); padding:10px 12px; border-radius:10px; }

/* aux */
.mr-aux { display:flex; justify-content:space-between; align-items:center; margin-top:8px; color:var(--mr-muted-2); font-size:13px; }
.mr-link { color: var(--mr-purple-300); text-decoration: none; font-weight:700; }

/* right column */
.mr-auth-right { display:flex; align-items:center; justify-content:center; }
.mr-right-card { width:100%; height:100%; background: linear-gradient(180deg, rgba(139,92,246,0.06), rgba(255,255,255,0.02)); border-radius:12px; padding:16px; border:1px solid rgba(255,255,255,0.04); box-shadow: 0 18px 40px rgba(6,8,20,0.6); color:var(--mr-muted); display:flex; flex-direction:column; gap:12px; align-items:stretch; }
.mr-right-hero { position:relative; height:120px; border-radius:10px; overflow:hidden; display:flex; align-items:center; justify-content:center; }
.mr-right-wave path { fill: url(#grad); opacity: 0.12; }
.mr-right-illustration { font-size:46px; transform: translateY(6px); }
.mr-right-body h4 { margin:8px 0 6px 0; color:var(--mr-muted); font-weight:800; }
.mr-hint { color:var(--mr-muted-2); font-size:13px; margin-bottom:8px; }
.mr-benefits { margin:0; padding:0 0 0 18px; color:var(--mr-muted-2); font-weight:700; }

/* footer */
.mr-auth-foot { margin-top:12px; text-align:center; color:var(--mr-muted-2); font-size:12px; }

/* small screens */
@media (max-width:900px){
  .mr-auth-grid { grid-template-columns: 1fr; }
  .mr-auth-right { display:none; }
  .mr-auth-modal { padding: 16px; }
}

</style>
</head>
<body>
<div id="stageWrap" class="stage-wrap" aria-hidden="false">
<div id="stage" class="stage" role="region" aria-label="MushRush early access">

<div class="left panel">
<div class="header">
<div class="logo" aria-hidden="true">M</div>
<div>
<div class="title">MushRush â€” Early Access</div>
<div class="subtitle">Marketing landing â€¢ Share to climb the queue</div>
</div>
<div style="margin-left:auto;display:flex;gap:8px;align-items:center">
<button class="btn-task small" id="copyRef" title="Copy referral address">Copy ref</button>
</div>
</div>

<div>
<div class="h1">GET EARLY ACCESS</div>
<div class="lead" style="margin-top:8px">Complete a few simple tasks and share your referral to move up the early access queue.</div>
</div>

<div class="ref-block">
<div class="ref-required">Referral code/address is <strong>required</strong> to register</div>
<div class="input-row">
<input id="useRef" class="input" placeholder="Enter referral code or wallet address (required)" maxlength="80" aria-label="Referral code or address" />
<button id="applyRef" class="btn-apply" title="Apply referral">Apply</button>
</div>
<div style="display:flex;gap:8px;align-items:center;margin-top:8px">
<div class="hint">Your referral:</div>
<div style="font-weight:800;color:var(--purple-300)" id="myRefShort">RF-XXXX</div>
<div class="hint" style="margin-left:6px;color:var(--muted-2)" id="myFullRef">0x...hidden</div>
</div>
</div>

<div class="tasks" id="tasks">
<div class="task-row" data-task="discord">
<div class="task-left"><span class="task-dot" id="dot-discord"></span><div class="task-label">Join our Discord</div></div>
<div><button class="btn-task" id="task-discord">Join</button></div>
</div>

<div class="task-row" data-task="share">
<div class="task-left"><span class="task-dot" id="dot-share"></span><div class="task-label">Share your referral card</div></div>
<div><button class="btn-task" id="task-share">Share</button></div>
</div>

<div class="task-row" data-task="follow">
<div class="task-left"><span class="task-dot" id="dot-follow"></span><div class="task-label">Follow us on X</div></div>
<div><button class="btn-task" id="task-follow">Follow</button></div>
</div>

<div class="progress" id="progressText">0 / 3 tasks completed</div>
</div>

<div class="cta-row">
<button id="registerBtn" class="btn-cta-primary" disabled>Register for Early Access</button>
<button id="sharePrimary" class="btn-cta-secondary">Share on X</button>
</div>
</div>

<div class="right" aria-live="polite">
<div class="card" id="playerCard" role="region" aria-label="Player card">
<div style="display:flex;justify-content:space-between;align-items:center">
<div style="font-weight:900;color:var(--muted-2)">PLAYER CARD</div>
<div style="display:flex;gap:10px">
<button id="downloadBtn" class="icon-btn download" title="Download card" aria-label="Download card">
<svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12 3v10" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M7 10l5 5 5-5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M5 20h14" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</button>

<button id="closeBtn" class="icon-btn close" title="Close card" aria-label="Close card">
<svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M18 6L6 18" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M6 6l12 12" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</button>
</div>
</div>

<div class="image-frame" style="margin-top:14px">
<div class="image-card"><img id="avatarImg" src="pc.avif" alt="player avatar" /></div>
</div>

<div class="card-meta">
<div class="meta-left">ID: <span id="playerId">(hidden)</span></div>
<div class="status" id="statusText">Not registered</div>
</div>

<div class="card-tasks">
<div class="task-row"><div class="task-left"><span class="task-dot" style="background:var(--success)"></span><div class="task-label">Complete all tasks to move up the queue</div></div></div>
<div style="margin-top:10px" class="hint">Share your card on X to attract referrals â€” referrals boost your access priority.</div>
</div>
</div>
</div>

</div>
</div>

<canvas id="confetti" class="confetti-canvas" aria-hidden="true"></canvas>
<div id="toast" class="toast" role="status" aria-live="polite">Copied to clipboard</div>


  <!-- =========== MushRush Auth Modal (paste near end of <body>) =========== -->
<div id="mr-auth-overlay" class="mr-auth-overlay" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="mr-auth-title">
  <div class="mr-auth-modal" role="document">
    <button class="mr-auth-close" id="mrAuthClose" aria-label="Close authentication dialog">&times;</button>

    <div class="mr-auth-grid">
      <!-- Left: forms -->
      <div class="mr-auth-left">
        <div class="mr-brand">
          <div class="mr-logo">M</div>
          <div class="mr-copy">
            <div class="mr-title" id="mr-auth-title">Welcome back to MushRush</div>
            <div class="mr-sub">Sign in or create an account to move up the queue</div>
          </div>
        </div>

        <div class="mr-tabs" role="tablist" aria-label="Authentication tabs">
          <button id="mrTabSignIn" class="mr-tab mr-tab--active" role="tab" aria-selected="true">Sign in</button>
          <button id="mrTabSignUp" class="mr-tab" role="tab" aria-selected="false">Sign up</button>
        </div>

        <div class="mr-oauth-row">
          <button id="mrOauthX" class="mr-oauth btn-x" aria-label="Continue with X (Twitter)">
            <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M23 4.5c-.7.3-1.5.5-2.3.6.8-.5 1.4-1.3 1.7-2.2-.7.4-1.6.8-2.5 1C18.8 3 17.7 2.4 16.5 2.4c-2 0-3.6 1.7-3.6 3.8 0 .3 0 .7.1 1C9.7 7.1 6.1 5.4 3.8 3c-.4.7-.7 1.6-.7 2.6 0 1.6.8 3 2 3.9-.7 0-1.4-.2-2-.6v.1c0 2.3 1.6 4.2 3.7 4.6-.4.1-.8.2-1.3.2-.3 0-.6 0-.9-.1.6 2 2.5 3.5 4.7 3.5-1.8 1.3-4.1 2-6.6 2-.4 0-.8 0-1.2-.1 2.4 1.6 5.2 2.6 8.3 2.6 9.9 0 15.3-8.5 15.3-15.9V6.8c1.1-.8 2-1.7 2.7-2.7z"/></svg>
            Continue with X
          </button>
        </div>

        <div class="mr-divider"><span>or</span></div>

        <!-- SIGN IN FORM -->
        <form id="mrSignInForm" class="mr-form" autocomplete="on" novalidate>
          <label class="mr-label">Email or username
            <input id="mr-si-username" class="mr-input" name="username" required />
          </label>

          <label class="mr-label">Password
            <input id="mr-si-password" class="mr-input" name="password" type="password" required />
          </label>

          <div id="mr-si-error" class="mr-error" aria-live="polite" style="display:none"></div>

          <div class="mr-actions">
            <button type="submit" class="mr-btn mr-btn-primary">Sign in</button>
            <button type="button" id="mr-si-cancel" class="mr-btn mr-btn-ghost">Cancel</button>
          </div>

          <div class="mr-aux">
            <label class="mr-aux-line"><input type="checkbox" id="mr-remember" /> Remember me</label>
            <a href="#" class="mr-link">Forgot password?</a>
          </div>
        </form>

        <!-- SIGN UP FORM -->
        <form id="mrSignUpForm" class="mr-form" autocomplete="on" novalidate style="display:none">
          <label class="mr-label">Username
            <input id="mr-su-username" class="mr-input" name="username" required />
          </label>
          <label class="mr-label">Email
            <input id="mr-su-email" class="mr-input" name="email" type="email" required />
          </label>

          <label class="mr-label">Password
            <input id="mr-su-password" class="mr-input" name="password" type="password" minlength="8" required />
            <div class="mr-strength" aria-hidden="true">
              <span id="mrStrengthBar" class="mr-strength-bar"></span>
            </div>
          </label>

          <label class="mr-label">Confirm password
            <input id="mr-su-password-confirm" class="mr-input" name="passwordConfirm" type="password" required />
          </label>

          <label class="mr-label">Referral code (optional)
            <input id="mr-su-ref" class="mr-input" name="ref" />
          </label>

          <div id="mr-su-error" class="mr-error" aria-live="polite" style="display:none"></div>

          <div class="mr-actions">
            <button type="submit" class="mr-btn mr-btn-primary">Create account</button>
            <button type="button" id="mr-su-cancel" class="mr-btn mr-btn-ghost">Cancel</button>
          </div>
        </form>

      </div>

      <!-- Right: visual / benefits -->
      <aside class="mr-auth-right" aria-hidden="true">
        <div class="mr-right-card">
          <div class="mr-right-hero">
            <svg class="mr-right-wave" viewBox="0 0 200 100" preserveAspectRatio="none" aria-hidden="true">
              <path d="M0,40 C40,0 120,90 200,40 L200,100 L0,100 Z"></path>
            </svg>
            <div class="mr-right-illustration" aria-hidden="true">ðŸš€</div>
          </div>

          <div class="mr-right-body">
            <h4>Fast signup â€” social or email</h4>
            <p class="mr-hint">Use X to sign in instantly. Or create an account with email â€” both grant access to your referral & queue position.</p>

            <ul class="mr-benefits">
              <li>Secure sessions (cookie-based)</li>
              <li>Referral preserves credit</li>
              <li>One-click X login</li>
            </ul>
          </div>
        </div>
      </aside>
    </div>

    <div class="mr-auth-foot">
      By creating an account you agree to our <a href="#" class="mr-link">Terms</a> & <a href="#" class="mr-link">Privacy</a>.
    </div>
  </div>
</div>
<!-- =========== End modal =========== -->

<script>
/* client-auth.js: simple frontend hooks for real login + tasks */
(function(){
// open popup to start login
const loginBtn = document.createElement('button');
loginBtn.id = 'loginX';
loginBtn.className = 'btn-task small';
loginBtn.textContent = 'Sign in with X';
loginBtn.style.marginLeft = '8px';
const headerRight = document.querySelector('.header > div[style*="margin-left:auto"]');
if(headerRight) headerRight.insertBefore(loginBtn, headerRight.firstChild);

function openLoginPopup(){
const w = window.open('/auth/x/login','xlogin','width=520,height=640');
// wait for postMessage from popup
function onMsg(ev){
if(ev.data && ev.data.type === 'mushrush.x.auth'){
window.removeEventListener('message', onMsg);
pollMe();
}
}
window.addEventListener('message', onMsg);
// Also poll until session established
setTimeout(pollMe, 800);
}
loginBtn.addEventListener('click', openLoginPopup);

async function pollMe(){
try {
const r = await fetch('/api/me');
const j = await r.json();
if(j.logged){
applyLoginState(j.user);
} else {
// not logged yet
}
} catch(e){ console.error(e); }
}

function applyLoginState(user){
loginBtn.textContent = 'Signed in: @' + (user.username || user.name || user.id);
loginBtn.classList.add('done');
document.getElementById('registerBtn').disabled = false;
}

// override share behaviour to call server /api/share
async function shareWithServer(ref){
try {
const res = await fetch('/api/share', {
method: 'POST',
headers: {'Content-Type': 'application/json'},
body: JSON.stringify({ ref })
});
const j = await res.json();
if(j.data){
markTaskClient('share');
showToast('Shared on X');
} else {
showToast('Share failed; check console');
console.log(j);
}
} catch(e){ console.error(e); showToast('Share failed'); }
}

// helper: mark task server-side and client-side
async function markTaskServer(task){
try {
const r = await fetch('/api/task/mark', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ task }) });
const j = await r.json();
if(j.ok) markTaskClient(task);
} catch(e){ console.error(e); }
}
function markTaskClient(task){
// mirror original markTask behaviour (uses localStorage)
const s = JSON.parse(localStorage.getItem('mushrush.tasks')||'{}');
s[task] = true;
localStorage.setItem('mushrush.tasks', JSON.stringify(s));
// update UI (reuse your existing updateUI function)
if(window.updateUI) window.updateUI(s);
}

// wire up share buttons
document.getElementById('task-share').addEventListener('click', ()=> {
const ref = document.getElementById('myFullRef').dataset.full || document.getElementById('myRefShort').innerText;
shareWithServer(ref);
});
document.getElementById('sharePrimary').addEventListener('click', ()=> {
const ref = document.getElementById('myFullRef').dataset.full || document.getElementById('myRefShort').innerText;
shareWithServer(ref);
});

// follow verification: call /api/follows-status and mark task if true
document.getElementById('task-follow').addEventListener('click', async ()=>{
try {
const r = await fetch('/api/follows-status');
const j = await r.json();
if(j.follows){
markTaskServer('follow');
showToast('Follow verified');
} else {
showToast('Not following yet â€” open X to follow');
// open project X page so user can follow
window.open('https://twitter.com/' + (document.querySelector('#projectHandle')?.value || 'mushrush'), '_blank');
}
} catch(e){ console.error(e); showToast('Follow check failed'); }
});

// discord task: just open invite and mark when window regains focus
document.getElementById('task-discord').addEventListener('click', ()=>{
const start = Date.now();
const w = window.open('https://discord.gg/your-invite-code','_blank');
function onFocus(){
// simple heuristic: treat as done once user returns
markTaskServer('discord');
showToast('Discord joined (heuristic)');
window.removeEventListener('focus', onFocus);
}
window.addEventListener('focus', onFocus);
});

// when page loads, attempt to poll user status to update UI
pollMe();

})();
</script>
<script>
  /* =========== MushRush Auth Modal JS =========== */
(function(){
  /* Elements */
  const overlay = document.getElementById('mr-auth-overlay');
  const closeBtn = document.getElementById('mrAuthClose');
  const openBtn = document.querySelector('#openSignIn') || document.querySelector('.mr-open-signin'); // if you have open button
  const tabSignIn = document.getElementById('mrTabSignIn');
  const tabSignUp = document.getElementById('mrTabSignUp');
  const signInForm = document.getElementById('mrSignInForm');
  const signUpForm = document.getElementById('mrSignUpForm');
  const oauthX = document.getElementById('mrOauthX');

  const siError = document.getElementById('mr-si-error');
  const suError = document.getElementById('mr-su-error');

  // Open/close modal
  let lastActive = null;
  function openModal(){
    lastActive = document.activeElement;
    overlay.setAttribute('aria-hidden','false');
    // small delay to allow CSS animation
    setTimeout(()=> overlay.style.opacity = 1, 10);
    // focus on first tab
    tabSignIn.focus();
    trapFocus(overlay);
  }
  function closeModal(){
    overlay.setAttribute('aria-hidden','true');
    overlay.style.opacity = 0;
    releaseFocusTrap();
    if(lastActive) lastActive.focus();
  }

  // attach open button if present
  if(openBtn) openBtn.addEventListener('click', openModal);
  closeBtn.addEventListener('click', closeModal);

  // close on Escape
  document.addEventListener('keydown', (e)=> { if(e.key === 'Escape' && overlay.getAttribute('aria-hidden') === 'false') closeModal(); });

  // tab switching
  function showTab(which){
    if(which === 'signin'){
      tabSignIn.classList.add('mr-tab--active'); tabSignUp.classList.remove('mr-tab--active');
      tabSignIn.setAttribute('aria-selected','true'); tabSignUp.setAttribute('aria-selected','false');
      signInForm.style.display = ''; signUpForm.style.display = 'none';
    } else {
      tabSignIn.classList.remove('mr-tab--active'); tabSignUp.classList.add('mr-tab--active');
      tabSignIn.setAttribute('aria-selected','false'); tabSignUp.setAttribute('aria-selected','true');
      signInForm.style.display = 'none'; signUpForm.style.display = '';
    }
  }
  tabSignIn.addEventListener('click', ()=> showTab('signin'));
  tabSignUp.addEventListener('click', ()=> showTab('signup'));

  /* Focus trap */
  let focusables = [];
  let firstFocusable = null, lastFocusable = null;
  function trapFocus(container){
    focusables = Array.from(container.querySelectorAll('a,button,input,[tabindex]:not([tabindex="-1"])')).filter(el => !el.disabled && el.offsetParent !== null);
    if(!focusables.length) return;
    firstFocusable = focusables[0]; lastFocusable = focusables[focusables.length - 1];
    container.addEventListener('keydown', handleKeydown);
  }
  function releaseFocusTrap(){
    overlay.removeEventListener('keydown', handleKeydown);
  }
  function handleKeydown(e){
    if(e.key === 'Tab'){
      if(e.shiftKey && document.activeElement === firstFocusable){ e.preventDefault(); lastFocusable.focus(); }
      else if(!e.shiftKey && document.activeElement === lastFocusable){ e.preventDefault(); firstFocusable.focus(); }
    }
  }

  /* Tiny helpers: toast + shake (error) */
  function shake(el){
    el.classList.add('mr-shake');
    setTimeout(()=> el.classList.remove('mr-shake'), 420);
  }

  // applyLoginState: global hook for your app (update header etc.)
  window.applyLoginState = window.applyLoginState || function(user){
    // default behavior: attempt to update sign-in button text if present
    const headerBtn = document.querySelector('#openSignIn') || document.querySelector('.btn-task.small');
    if(headerBtn) { headerBtn.textContent = 'Signed in: @' + (user.username || user.name || user.id); headerBtn.classList.add('done'); }
    const registerBtn = document.getElementById('registerBtn');
    if(registerBtn) registerBtn.disabled = false;
    closeModal();
  };

  /* ============= Form handling ============= */

  // helper to POST json
  async function postJson(url, data){
    const res = await fetch(url, { method:'POST', credentials:'include', headers:{ 'Content-Type':'application/json' }, body: JSON.stringify(data) });
    const body = await res.json().catch(()=>({ ok:false, message:'Invalid JSON from server' }));
    if(!res.ok) throw body;
    return body;
  }

  // Sign-in
  signInForm.addEventListener('submit', async (e)=>{
    e.preventDefault();
    siError.style.display = 'none';
    const username = document.getElementById('mr-si-username').value.trim();
    const password = document.getElementById('mr-si-password').value;
    if(!username || !password){ siError.textContent = 'Please complete both fields.'; siError.style.display = ''; shake(siError); return; }

    try {
      // adjust endpoint as needed
      const result = await postJson('/api/auth/signin', { username, password });
      if(result.user) {
        window.applyLoginState(result.user);
      } else {
        siError.textContent = result.message || 'Sign in failed';
        siError.style.display = ''; shake(siError);
      }
    } catch(err){
      siError.textContent = err.message || 'Network error';
      siError.style.display = ''; shake(siError);
      console.error('Sign in error', err);
    }
  });

  document.getElementById('mr-si-cancel').addEventListener('click', closeModal);

  // Sign-up
  signUpForm.addEventListener('submit', async (e)=>{
    e.preventDefault();
    suError.style.display = 'none';
    const username = document.getElementById('mr-su-username').value.trim();
    const email = document.getElementById('mr-su-email').value.trim();
    const password = document.getElementById('mr-su-password').value;
    const passwordConfirm = document.getElementById('mr-su-password-confirm').value;
    const ref = document.getElementById('mr-su-ref').value.trim();

    if(!username || !email || !password || !passwordConfirm){ suError.textContent = 'Please fill all required fields.'; suError.style.display = ''; shake(suError); return; }
    if(password !== passwordConfirm){ suError.textContent = 'Passwords do not match.'; suError.style.display = ''; shake(suError); return; }
    if(password.length < 8){ suError.textContent = 'Password must be at least 8 characters.'; suError.style.display = ''; shake(suError); return; }

    try {
      const result = await postJson('/api/auth/signup', { username, email, password, ref });
      if(result.user) window.applyLoginState(result.user);
      else { suError.textContent = result.message || 'Sign up failed'; suError.style.display = ''; shake(suError); }
    } catch(err) {
      suError.textContent = err.message || 'Network error';
      suError.style.display = ''; shake(suError);
      console.error('Sign up error', err);
    }
  });

  document.getElementById('mr-su-cancel').addEventListener('click', closeModal);

  /* Password strength meter */
  const strengthBar = document.getElementById('mrStrengthBar');
  const suPassword = document.getElementById('mr-su-password');
  if(suPassword && strengthBar){
    suPassword.addEventListener('input', ()=> {
      const val = suPassword.value || '';
      const score = passwordScore(val); // 0-100
      strengthBar.style.width = score + '%';
      // optionally change color by low/medium/high
      strengthBar.style.filter = score > 66 ? 'saturate(130%)' : score > 33 ? 'saturate(100%)' : 'grayscale(40%)';
    });
  }
  function passwordScore(p){
    let score = 0;
    if(p.length > 7) score += Math.min(40, p.length * 2);
    if(/[A-Z]/.test(p)) score += 20;
    if(/[0-9]/.test(p)) score += 20;
    if(/[^A-Za-z0-9]/.test(p)) score += 20;
    return Math.min(100, score);
  }

  /* ============= OAuth (X/Twitter) popup + postMessage + poll fallback ============= */
  oauthX.addEventListener('click', ()=>{
    const popup = window.open('/auth/x/login', 'mushrush_x', 'width=640,height=720');
    if(!popup){ alert('Please enable popups to sign in with X'); return; }

    // listen for postMessage from popup
    function onMessage(ev){
      if(!ev.data) return;
      if(ev.data.type === 'mushrush.x.auth'){
        window.removeEventListener('message', onMessage);
        if(ev.data.user) { window.applyLoginState(ev.data.user); }
        else { alert('Authentication failed'); }
      }
    }
    window.addEventListener('message', onMessage);

    // fallback: poll /api/me while popup is open (in case popup sets cookie then redirects quietly)
    const poll = setInterval(async ()=>{
      try {
        const r = await fetch('/api/me', { credentials:'include' });
        if(r.ok){ const j = await r.json().catch(()=>null); if(j && j.logged){ clearInterval(poll); window.applyLoginState(j.user); } }
      } catch(e){}
      // stop polling if popup closed
      if(popup && popup.closed){ clearInterval(poll); window.removeEventListener('message', onMessage); }
    }, 900);
  });

  /* On load: try to detect existing session */
  (async function initMe(){
    try {
      const r = await fetch('/api/me', { credentials: 'include' });
      if(r.ok){
        const j = await r.json().catch(()=>null);
        if(j && j.logged) window.applyLoginState(j.user);
      }
    } catch(e){}
  })();

  /* Optional: close on click outside modal core */
  overlay.addEventListener('click', (ev) => {
    if(ev.target === overlay) closeModal();
  });

  /* Small shake animation style injection for errors (scoped) */
  (function injectShake(){
    const css = `.mr-shake{animation:mrShake .42s cubic-bezier(.36,.07,.19,.97);}@keyframes mrShake{10%,90%{transform:translateX(-1px)}20%,80%{transform:translateX(2px)}30%,50%,70%{transform:translateX(-4px)}40%,60%{transform:translateX(4px)} }`;
    const s = document.createElement('style'); s.appendChild(document.createTextNode(css)); document.head.appendChild(s);
  })();

})();

</script>

</body>
</html>
