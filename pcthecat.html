<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>MushRush — Landing / Referral Card (Polished)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{--bg:#02020a;--muted:rgba(255,255,255,0.62);--muted-2:rgba(255,255,255,0.34);--purple-600:#6b21a8;--purple-400:#a78bfa;--teal:#00c2a8;--success:#22c55e}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#03020a 0%, #07030f 100%);color:#f5f8ff;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;overflow:hidden}
  .stage-wrap{width:1200px;height:720px;margin:0 auto;transform-origin:top left}
  .stage{display:grid;grid-template-columns:520px 1fr;gap:28px;height:100%;padding:22px;box-sizing:border-box}
  .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 10px 30px rgba(2,6,20,0.6)}

  /* header */
  .header{display:flex;align-items:center;gap:12px}
  .logo{width:54px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--purple-600),var(--purple-400));display:flex;align-items:center;justify-content:center;font-weight:800}
  .title{font-weight:700}
  .subtitle{font-size:13px;color:var(--muted-2)}

  /* left */
  .welcome{font-family:Space Mono,monospace;font-weight:700;color:white}
  .code-large{font-family:Space Mono,monospace;font-size:36px;color:var(--purple-400);letter-spacing:1px}
  .muted{color:var(--muted);font-size:13px}
  .ref-row{display:flex;align-items:center;gap:10px}
  .ref-code{font-family:Space Mono,monospace;padding:10px 12px;border-radius:8px;background:rgba(255,255,255,0.01);border:1px solid rgba(255,255,255,0.03);font-weight:700;color:var(--teal);font-size:18px}
  .input{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}

  .btn{padding:12px 14px;border-radius:10px;border:0;font-weight:700;cursor:pointer}
  .btn-primary{background:linear-gradient(90deg,var(--purple-600),var(--purple-400));color:white}
  .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
  .btn-cta{background:linear-gradient(90deg,#ff6fcf,#7c3aed);color:white}

  /* right */
  .card-wrap{width:440px}
  .rainbow{padding:6px;border-radius:14px;background:linear-gradient(135deg,#a78bfa,#7c3aed,#ff6fcf,#6ee7b7)}
  .player-card{background:linear-gradient(180deg,#0b0a0f, rgba(255,255,255,0.01));border-radius:10px;padding:12px;color:var(--muted)}
  .avatar{height:360px;border-radius:8px;background-size:cover;background-position:center;border:1px solid rgba(255,255,255,0.03)}
  .idline{color:var(--muted-2);font-weight:700}

  /* TASKS - polished */
  .tasks{margin-top:14px;display:flex;flex-direction:column;gap:10px}
  .task-row{display:flex;align-items:center;justify-content:space-between;padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.02);transition:all .18s ease}
  .task-left{display:flex;align-items:center;gap:12px}
  .task-dot{width:14px;height:14px;border-radius:50%;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.03);display:inline-block}
  .task-label{font-weight:700}
  .task-done{background:var(--success);box-shadow:0 6px 18px rgba(34,197,94,0.14);transform:scale(1.05)}
  .progress{margin-top:12px;text-align:center;font-weight:800}

  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:#0b0b10;padding:12px 16px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 12px 30px rgba(0,0,0,0.6);opacity:0;pointer-events:none;transition:opacity .18s ease}
  .toast.show{opacity:1;pointer-events:auto}

  /* congrats modal */
  .overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.85));z-index:9999}
  .overlay-card{background:#0b0b10;padding:24px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);text-align:center;max-width:520px}
  .overlay-card h2{margin:0 0 8px 0}
  .overlay-card p{margin:0 0 12px 0;color:var(--muted-2)}
  .confetti-canvas{position:fixed;inset:0;pointer-events:none;z-index:10000}

  /* small interactions */
  .icon-btn{width:44px;height:44px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);display:inline-flex;align-items:center;justify-content:center;background:transparent;cursor:pointer}

  button:focus,input:focus{outline:none;box-shadow:0 0 0 4px rgba(107,33,168,0.12)}
</style>
</head>
<body>
  <div id="stageWrap" class="stage-wrap">
    <div class="stage">

      <div class="left panel">
        <div class="header">
          <div class="logo">M</div>
          <div>
            <div class="title">MushRush — Early Access</div>
            <div class="subtitle">Marketing landing • Share to climb the queue</div>
          </div>
          <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
            <button class="icon-btn" title="Menu">≡</button>
            <button class="icon-btn" id="loginX">X</button>
          </div>
        </div>

        <div style="margin-top:10px">
          <div class="welcome">GET EARLY ACCESS</div>
          <div class="code-large" id="bigCode">CODE-09-6617</div>
          <div class="muted" style="margin-top:6px">This page is marketing-only while the game is in development. Share your referral to increase queue priority.</div>
        </div>

        <div style="margin-top:6px">
          <div class="ref-row">
            <div class="ref-code" id="myRef">RF-7G-4K</div>
            <button id="copyRef" class="btn btn-ghost">Copy</button>
          </div>
          <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
            <input id="useRef" class="input" placeholder="Use someone's referral code (optional)" maxlength="10" />
            <button id="applyRef" class="btn btn-primary">Apply</button>
          </div>
        </div>

        <div style="margin-top:12px;display:flex;gap:10px">
          <button id="registerBtn" class="btn btn-primary">Register for Early Access</button>
          <button id="sharePrimary" class="btn btn-cta">Share on X</button>
        </div>

      </div>

      <div class="right">
        <div class="card-wrap">
          <div class="rainbow">
            <div class="player-card">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div style="font-weight:800">PLAYER CARD</div>
                <div style="display:flex;gap:8px">
                  <button class="icon-btn" title="Download">⬇</button>
                  <button class="icon-btn" title="Close">✕</button>
                </div>
              </div>

              <div style="margin-top:12px">
                <div id="avatar" class="avatar" style="background-image:url('pc.avif')"></div>
                <div class="meta" style="margin-top:12px">
                  <div><div class="idline">ID: <span id="playerId">CODE-09-6617</span></div></div>
                  <div style="text-align:right"><div class="small">Status</div><div style="font-weight:800;color:white" id="statusText">Not registered</div></div>
                </div>

                <div class="tasks" id="tasks">
                  <div class="task-row" data-task="follow">
                    <div class="task-left"><span class="task-dot" id="dot-follow"></span><div class="task-label">Follow us on X</div></div>
                    <div><button class="btn btn-ghost" id="task-follow">Follow</button></div>
                  </div>
                  <div class="task-row" data-task="discord">
                    <div class="task-left"><span class="task-dot" id="dot-discord"></span><div class="task-label">Join our Discord</div></div>
                    <div><button class="btn btn-ghost" id="task-discord">Join</button></div>
                  </div>
                  <div class="task-row" data-task="share">
                    <div class="task-left"><span class="task-dot" id="dot-share"></span><div class="task-label">Share your referral card</div></div>
                    <div><button class="btn btn-primary" id="task-share">Share</button></div>
                  </div>
                  <div class="progress" id="progressText">0 / 3 tasks completed</div>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <div id="toast" class="toast">Copied to clipboard</div>
  <canvas id="confetti" class="confetti-canvas"></canvas>

  <script>
    // Scale-to-fit
    (function fitStage(){
      const wrap = document.getElementById('stageWrap');
      function apply(){
        const vw = window.innerWidth - 24;
        const vh = window.innerHeight - 24;
        const iw = wrap.offsetWidth;
        const ih = wrap.offsetHeight;
        const scale = Math.min(vw/iw, vh/ih, 1);
        wrap.style.transform = 'scale(' + scale + ')';
        wrap.style.marginTop = ((vh - ih*scale)/2 + 12) + 'px';
      }
      window.addEventListener('resize', apply);
      apply();
    })();

    // Toast helper
    function showToast(msg){ const t=document.getElementById('toast'); t.textContent=msg; t.classList.add('show'); clearTimeout(t._t); t._t=setTimeout(()=>t.classList.remove('show'),2200); }

    // Confetti (small, no libs)
    function fireConfetti(){
      const canvas = document.getElementById('confetti'); const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth; canvas.height = window.innerHeight;
      const pieces = [];
      const colors = ['#ff6fcf','#a78bfa','#6ee7b7','#ffd166','#ff8a65'];
      for(let i=0;i<120;i++){ pieces.push({x:Math.random()*canvas.width,y:Math.random()*-canvas.height, vx:(Math.random()-0.5)*6, vy:2+Math.random()*6, size:6+Math.random()*6, color:colors[Math.floor(Math.random()*colors.length)], rot:Math.random()*360}); }
      let t=0; function frame(){ ctx.clearRect(0,0,canvas.width,canvas.height); for(const p of pieces){ p.x += p.vx; p.y += p.vy; p.vy += 0.08; p.rot += 8; ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot*Math.PI/180); ctx.fillStyle=p.color; ctx.fillRect(-p.size/2,-p.size/2,p.size,p.size); ctx.restore(); } t++; if(t<160) requestAnimationFrame(frame); else ctx.clearRect(0,0,canvas.width,canvas.height); }
      frame();
    }

    // TASK CHECKER - improved verification: open new tab and detect focus return after a short time
    const TASKS = ['follow','discord','share'];
    function loadState(){ return JSON.parse(localStorage.getItem('mushrush.tasks')||'{}'); }
    function saveState(s){ localStorage.setItem('mushrush.tasks', JSON.stringify(s)); }
    function updateUI(s){ let done=0; TASKS.forEach(t=>{ const el=document.getElementById('dot-'+t); if(s[t]){ el.classList.add('task-done'); } else el.classList.remove('task-done'); if(s[t]) done++; }); document.getElementById('progressText').textContent = `${done} / 3 tasks completed`; if(done===3) { document.getElementById('statusText').textContent='Registered'; showCongrats(); } }

    function markTask(t){ const s = loadState(); s[t]=true; saveState(s); updateUI(s); }

    // open and verify by focus heuristic
    async function openAndVerify(url, taskKey){
      const start = Date.now(); const w = window.open(url, '_blank'); if(!w){ alert('Pop-up blocked — allow popups to verify tasks'); return; }
      // wait for focus back
      const onFocus = ()=>{ const elapsed = Date.now() - start; // require user to spend small time (1.5s)
        if(elapsed>1500){ markTask(taskKey); showToast('Verified: ' + taskKey); } else { /* too quick - but still mark, UX lenient */ markTask(taskKey); showToast('Marked: ' + taskKey); }
        window.removeEventListener('focus', onFocus);
      };
      window.addEventListener('focus', onFocus);
    }

    // share via X intent
    function shareOnX(ref){ const pageUrl = window.location.href; const text = `I'm on the MushRush early access waitlist! Use my referral code ${ref} to increase your spot. ${pageUrl} #MushRush`; const url = 'https://twitter.com/intent/tweet?text=' + encodeURIComponent(text); const w = window.open(url,'_blank'); if(w) { const start=Date.now(); window.addEventListener('focus', function onF(){ const elapsed=Date.now()-start; markTask('share'); showToast('Thanks for sharing!'); window.removeEventListener('focus', onF); }); } }

    // UI wiring
    document.getElementById('copyRef').addEventListener('click', ()=>{ const txt=document.getElementById('myRef').innerText; navigator.clipboard.writeText(txt); showToast('Referral copied'); });
    document.getElementById('applyRef').addEventListener('click', ()=>{ const v=document.getElementById('useRef').value.trim(); if(!v) return showToast('Enter a referral code'); showToast('Referral applied: ' + v); });
    document.getElementById('registerBtn').addEventListener('click', ()=>{ const logged = localStorage.getItem('mushrush.loggedX') === '1'; if(!logged) return alert('Please sign in with X first'); showToast('Registered (demo)'); document.getElementById('statusText').textContent='Registered'; });

    document.getElementById('task-follow').addEventListener('click', ()=> openAndVerify('https://twitter.com/intent/follow?screen_name=your_project_handle','follow'));
    document.getElementById('task-discord').addEventListener('click', ()=> openAndVerify('https://discord.gg/your-invite-code','discord'));
    document.getElementById('task-share').addEventListener('click', ()=> { const ref=document.getElementById('myRef').innerText; shareOnX(ref); });

    document.getElementById('sharePrimary').addEventListener('click', ()=>{ const ref=document.getElementById('myRef').innerText; shareOnX(ref); });

    // Show congrats modal with confetti
    function showCongrats(){ if(document.getElementById('congrats')) return; fireConfetti(); const overlay=document.createElement('div'); overlay.className='overlay'; overlay.id='congrats'; overlay.innerHTML = `<div class='overlay-card'><h2>Congrats — 3/3 Complete</h2><p>You will be notified about your early access. We appreciate you sharing!</p><div style='display:flex;gap:8px;justify-content:center;margin-top:12px'><button id='closeCongrats' class='btn btn-primary'>Close</button></div></div>`; document.body.appendChild(overlay); document.getElementById('closeCongrats').addEventListener('click', ()=>{ overlay.remove(); }); }

    // derive friendly ref from wallet
    (async function setRef(){ try{ if(window.ethereum){ const accs = await window.ethereum.request({method:'eth_accounts'}); if(accs && accs[0]){ const r=accs[0].slice(2,8).toUpperCase(); const f='RF-'+r.slice(0,2)+'-'+r.slice(2,4); document.getElementById('myRef').innerText=f; document.getElementById('bigCode').innerText='CODE-'+r.slice(0,2)+'-'+r.slice(2,4); document.getElementById('playerId').innerText=document.getElementById('bigCode').innerText; } } }catch(e){console.log(e)} const s=loadState(); updateUI(s); })();

  </script>
</body>
</html>
